<module id="corner.orm" version="1.0.0">
	<!-- for spring integration -->
	<implementation service-id="hivemind.lib.DefaultSpringBeanFactoryHolder">
		<invoke-factory>
			<construct autowire-services="false"
				class="corner.orm.hivemind.SpringBeanFactoryHolderImpl">
				<event-listener service-id="hivemind.ShutdownCoordinator"/>
			</construct>
		</invoke-factory>
	</implementation>
	<!-- for hibernate data squeeze adaptor -->
	<service-point id="HibernateAdapter"
		interface="org.apache.tapestry.util.io.SqueezeAdaptor">
		<invoke-factory>
			<construct class="corner.orm.tapestry.HibernateAdapter">
				<set-object property="entityService"
					value="spring:entityService"/>
			</construct>
		</invoke-factory>
	</service-point>

	<contribution configuration-id="tapestry.data.SqueezeAdaptors">
		<adaptor object="service:HibernateAdapter"/>
	</contribution>

	<!-- for open seesion one per quest -->

    <service-point id="CornerOneSessionPerQuestFilter" interface="org.apache.tapestry.services.WebRequestServicerFilter">
        <invoke-factory>
            <construct class="corner.orm.tapestry.filter.OneSessionPerServletRequestFilter">
                <set property="transactionPerRequest" value="${corner.transaction-per-request}"/>
                <set-object property="sessionFactory"
					value="spring:sessionFactory"/>
                <set-object property="transactionManager"
					value="spring:transactionManager"/>
            </construct>
        </invoke-factory>
    </service-point>

    <contribution configuration-id="hivemind.FactoryDefaults">
        <default symbol="corner.transaction-per-request" value="false"/>
    </contribution>

    <contribution configuration-id="tapestry.request.WebRequestServicerPipeline">
        <filter name="CornerOneSessionPerQuestFilter" object="service:CornerOneSessionPerQuestFilter"/>
    </contribution>
</module>